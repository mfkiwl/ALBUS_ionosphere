cmake_minimum_required(VERSION 3.10)
project(vex LANGUAGES C)

# Define headers. Note that y.tab.h is generated.
set(HEADERS
    ${CMAKE_CURRENT_SOURCE_DIR}/vex++.h
    ${CMAKE_CURRENT_SOURCE_DIR}/vex.h
    ${CMAKE_CURRENT_BINARY_DIR}/y.tab.h
)


# Find Bison and Flex for generating parser files
find_package(BISON REQUIRED)
find_package(FLEX REQUIRED)

# Configure Bison
BISON_TARGET(yacc_target
    ${CMAKE_CURRENT_SOURCE_DIR}/vex.y
    ${CMAKE_CURRENT_BINARY_DIR}/y.tab.c
    DEFINES_FILE ${CMAKE_CURRENT_BINARY_DIR}/y.tab.h
)

# Configure Flex; generate vex.yy.c from vex.yy.l
FLEX_TARGET(lex_target
    ${CMAKE_CURRENT_SOURCE_DIR}/vex.yy.l
    ${CMAKE_CURRENT_BINARY_DIR}/vex.yy.c
)


# Make the lex target dependent on the bison target.
ADD_FLEX_BISON_DEPENDENCY(lex_target yacc_target)

# Define the list of sources.
# Note: Adjust these source files as needed.
set(SOURCES
    # Your original source files (assumed to be C sources)
    ${CMAKE_CURRENT_SOURCE_DIR}/vex.y
    ${CMAKE_CURRENT_BINARY_DIR}/y.tab.c       # Generated by Bison (yacc_target)
    ${CMAKE_CURRENT_BINARY_DIR}/vex.yy.c        # Generated by Flex (lex_target)
    ${CMAKE_CURRENT_SOURCE_DIR}/vex_util.c
    ${CMAKE_CURRENT_SOURCE_DIR}/print_vex.c
    ${CMAKE_CURRENT_SOURCE_DIR}/vex_get.c
)

# Option 1: Build a static library
add_library(vex_static STATIC ${SOURCES})
set_target_properties(vex_static PROPERTIES OUTPUT_NAME "vex")

# Option 2: Build a shared library with versioning
add_library(vex SHARED ${SOURCES} )
set_target_properties(vex PROPERTIES OUTPUT_NAME "vex" 
 VERSION "${VER_MAJOR}.${VER_MINOR}.${VER_SUBSUB}"
  SOVERSION "${VER_MAJOR}"
)

target_link_libraries(vex PUBLIC fl)
# Installation rules: install both the libraries and headers
install(TARGETS vex 
    LIBRARY DESTINATION ${INSTALLDIR}/lib )


install(FILES ${HEADERS}
    DESTINATION ${INSTALLDIR}/include
)

